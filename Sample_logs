# ==============================
# Run Isolation Forest with LogAI
# ==============================

import pandas as pd
from logai.applications.application import LogAI
from logai.dataloader.opendataloader import OpenSetDataLoader

# 1. Load LogAI config
app = LogAI(config="config.yaml")

# 2. Load flattened CSV into LogDataset
loader = OpenSetDataLoader(
    dataset_name="csv_dataset",
    dataset_path="logs_flattened.csv"   # <-- your saved file
)
dataset = loader.load_data()

# 3. Run Isolation Forest (LogAI handles feature extraction per config.yaml)
result = app.run(dataset)

# 4. Inspect results
print("=== First few rows with anomaly labels ===")
print(result.head())

print("\n=== Anomaly counts ===")
print(result["anomaly_label"].value_counts())

# 5. Save enriched results locally
result.to_csv("logs_with_anomalies.csv", index=False)
print("\nSaved results to logs_with_anomalies.csv")