def extract_level_info_openwrt(row):
    text = str(
        row.get("metadata.template")
        or row.get("metadata.sample_first")
        or row.get("metadata.sample_last")
        or row.get("message", "")
    )

    # 1. Prefer textual log levels if present
    m = re.search(r"\b(debug|info|warn|error|critical|notice|trace)\b", text, re.IGNORECASE)
    if m:
        return "Unknown", m.group(1).capitalize()

    # 2. Otherwise fall back to device-specific L0..L7
    m = re.search(r"\bL([0-7])\b", text)
    if m:
        lnum = m.group(1)
        return f"L{lnum}", f"DeviceLevel{lnum}"

    # 3. Nothing found
    return "Unknown", "Unknown"

# Apply to dataframe
df[["log_level_code", "log_level_text"]] = df.apply(extract_level_info_openwrt, axis=1)