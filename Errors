# Robust datetime parsing, force UTC
df["@timestamp"] = pd.to_datetime(df["@timestamp"], errors="coerce", utc=True)

# If some rows became NaT, fill them
if df["@timestamp"].isna().any():
    print(f"⚠️ Found {df['@timestamp'].isna().sum()} rows with invalid @timestamp, filling forward/backward.")
    df["@timestamp"] = df["@timestamp"].fillna(method="ffill").fillna(method="bfill")

# Use @timestamp as index
df = df.sort_values("@timestamp").set_index("@timestamp")